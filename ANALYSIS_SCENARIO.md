# 📊 원가차이 분석 시나리오 가이드

## 🎯 개요

이 문서는 Neo4j 기반 원가차이 분석 시스템을 활용한 **순차적 분석 프로세스**를 설명합니다.

---

## 🚀 분석 워크플로우

### 📌 1단계: 대시보드에서 문제 발견
**화면:** `dashboard.html`

#### 무엇을 보나요?
- **전체 KPI**: 총 원가차이, 생산오더 수, 재료 수, 공정 수
- **차이 유형별 트렌드**: 수량차, 단가차, 생산량차의 시간별 추이
- **Top 10 리스트**: 차이가 큰 생산오더 목록

#### 어떻게 분석하나요?
```
예시 시나리오:
1. 대시보드를 열면 전체 원가차이가 -₩15,234,567로 표시됨
2. "차이 유형별 트렌드" 차트를 보니 2월에 수량차가 급증
3. "차이 큰 생산오더 Top 10"을 보니 PO-001이 1위 (-₩2,450,000)
4. PO-001 옆의 "상세보기" 버튼 클릭
   → analysis.html?order=PO-001 로 자동 이동
```

#### 화면 예시:
```
┌─────────────────────────────────────────────────────────┐
│  📊 Cost Variance Dashboard                             │
├─────────────────────────────────────────────────────────┤
│  [총차이: -₩15.2M] [오더: 100] [재료: 45] [공정: 8]    │
├─────────────────────────────────────────────────────────┤
│  📈 차이 유형별 트렌드                                  │
│     ┌───────────────────────────────┐                   │
│     │ /\  수량차                    │                   │
│     │/  \ /\  단가차                │                   │
│     │    /  \___ 생산량차           │                   │
│     └───────────────────────────────┘                   │
├─────────────────────────────────────────────────────────┤
│  🔥 차이 큰 생산오더 Top 10                             │
│     1. PO-001  (QFP80-004) -₩2.45M  [상세보기] ← 클릭! │
│     2. PO-015  (SON56-001) -₩1.82M  [상세보기]        │
│     3. PO-032  (BGA144-002) -₩1.56M [상세보기]        │
└─────────────────────────────────────────────────────────┘
```

---

### 📌 2단계: 전체 구조 파악
**화면:** `analysis.html` (생산오더 자동 로드)

#### 무엇을 보나요?
- 선택한 생산오더(PO-001)의 **전체 관계 그래프**
- 제품, 재료, 공정, 차이, 원인이 모두 연결된 네트워크

#### 분석 가이드가 알려주는 것:
```
📖 분석 가이드
───────────────────────────────────────
1단계: 전체 구조 파악

PO-001 생산오더가 선택되었습니다.

📍 지금 확인할 것:
• 어떤 제품(Product)을 생산했나요?
• 어떤 재료(Material)를 사용했나요?
• 어느 공정(WorkCenter)에서 작업했나요?
• 어떤 차이(Variance)가 발생했나요?

💡 다음 단계:
차이(Variance) 노드를 클릭하여 상세 정보를 확인하세요.
```

#### 화면 예시:
```
┌──────────────┬──────────────────────────────────────────┐
│              │  생산오더: PO-001                        │
│  필터        ├──────────────────────────────────────────┤
│  [제품: 전체]│                                          │
│  [공정: 전체]│       ◉ PO-001                          │
│  [기간: 전체]│      /│\                                 │
│              │     / │ \                                │
│  ──────────  │    /  │  \                               │
│  📖 분석가이드│   ◉   ◉   ◉                             │
│  1단계: 전체 │ Product Material WorkCenter              │
│  구조 파악   │         │                                │
│              │         │                                │
│  PO-001 선택 │         ◉                                │
│              │      Variance ← 클릭!                    │
│  📍 확인사항:│                                          │
│  • 제품?     │                                          │
│  • 재료?     │  [초기화] [포커스]                       │
│  • 공정?     │                                          │
│  • 차이?     │                                          │
└──────────────┴──────────────────────────────────────────┘
```

---

### 📌 3단계: 차이 상세 분석
**화면:** `analysis.html` (차이 노드 클릭 후)

#### 무엇을 보나요?
- 클릭한 차이 노드의 **상세 정보 패널** (오른쪽)
- 차이 유형, 금액, 심각도, 원가요소

#### 분석 가이드가 알려주는 것:
```
📖 분석 가이드
───────────────────────────────────────
2단계: 차이 분석

차이 노드를 선택했습니다.

📍 지금 확인할 것:
• 차이 유형은? (수량차/단가차/생산량차)
• 차이 금액은 얼마인가요?
• 심각도는? (HIGH/MEDIUM/LOW)
• 어떤 원가 요소에서 발생했나요?

💡 다음 단계:
차이 노드를 더블클릭하여 원인(Cause)을 확인하세요.
```

#### 화면 예시:
```
┌──────────────┬──────────────────────────────┬──────────┐
│              │                              │ 노드정보 │
│  📖 분석가이드│       ◉ PO-001              │──────────│
│  2단계: 차이 │      /│\                     │ Variance │
│  분석        │     / │ \                    │ V-001    │
│              │    /  │  \                   │──────────│
│  차이 노드를 │   ◉   ◉   ◉                 │ 유형:    │
│  선택했습니다│         │                    │ QUANTITY │
│              │         │                    │          │
│  📍 확인사항:│         ◉ ← 클릭됨!          │ 금액:    │
│  • 유형?     │      Variance               │ -₩2.45M  │
│  • 금액?     │                             │          │
│  • 심각도?   │                             │ 심각도:  │
│  • 원가요소? │  더블클릭하여 원인 확인 →   │ HIGH     │
│              │                             │          │
│  💡 다음:    │                             │ 요소:    │
│  더블클릭!   │                             │ MATERIAL │
└──────────────┴──────────────────────────────┴──────────┘
```

---

### 📌 4단계: 근본 원인 파악
**화면:** `analysis.html` (차이 노드 더블클릭 후)

#### 무엇을 보나요?
- 차이와 연결된 **원인(Cause) 노드**들이 표시됨
- DEFECT_RATE, MATERIAL_WASTE, EFFICIENCY 등

#### 분석 가이드가 알려주는 것:
```
📖 분석 가이드
───────────────────────────────────────
3단계: 근본 원인 파악

원인 노드가 표시되었습니다.

📍 지금 확인할 것:
• 왜 차이가 발생했나요?
  - DEFECT_RATE (불량률)
  - MATERIAL_WASTE (재료 낭비)
  - EFFICIENCY (효율성)
  - PRICE_CHANGE (가격 변동)

💡 다음 단계:
재료나 공정 노드를 더블클릭하여 더 깊이 탐색하거나,
🔍 포커스 버튼으로 핵심만 보세요.
```

#### 실제 분석 예시:
```
분석 결과:
1. PO-001의 수량차(-₩2.45M)를 더블클릭
2. 원인 노드 3개가 나타남:
   - DEFECT_RATE: 불량률 15% (정상 5%)
   - MATERIAL_WASTE: 재료 낭비 +20kg
   - EFFICIENCY: 작업 효율 82% (목표 95%)
3. DEFECT_RATE가 가장 큰 영향
4. 해당 노드를 클릭하면 상세 정보 확인
```

#### 화면 예시:
```
┌──────────────┬──────────────────────────────┬──────────┐
│              │                              │ 노드정보 │
│  📖 분석가이드│       ◉ PO-001              │──────────│
│  3단계: 근본 │      /│\                     │ Cause    │
│  원인 파악   │     / │ \                    │ DEFECT_  │
│              │    /  │  \                   │ RATE     │
│  원인 노드가 │   ◉   ◉   ◉                 │──────────│
│  표시됨      │         │                    │ 코드:    │
│              │         ◉                    │ C-001    │
│  📍 확인사항:│      Variance               │          │
│  • 불량률?   │      /  |  \                │ 설명:    │
│  • 재료낭비? │     /   |   \               │ 불량률   │
│  • 효율성?   │    ◉    ◉    ◉             │ 증가     │
│  • 가격변동? │ DEFECT WASTE EFFICIENCY     │          │
│              │   ↑클릭                     │ 영향도:  │
│  💡 다음:    │                             │ 85%      │
│  재료/공정   │  [초기화] [포커스]          │          │
│  확장        │                             │          │
└──────────────┴──────────────────────────────┴──────────┘
```

---

### 📌 5단계: 상세 탐색 및 포커스
**화면:** `analysis.html` (포커스 기능 사용)

#### 무엇을 보나요?
- **복잡한 그래프**를 단순화
- 선택한 노드와 직접 연결된 노드만 표시

#### 분석 가이드가 알려주는 것:
```
📖 분석 가이드
───────────────────────────────────────
4단계: 상세 탐색

노드를 확장하여 더 많은 정보를 볼 수 있습니다.

📍 활용 팁:
• 노드 클릭: 상세 정보 표시
• 노드 더블클릭: 연결된 노드 확장
• 🔍 포커스: 선택한 노드만 보기
• ↺ 초기화: 처음 상태로 돌아가기

💡 분석 완료:
이제 원인을 파악했으니 개선 방안을 수립하세요!
```

#### 실제 사용 예시:
```
복잡한 그래프에서:
1. DEFECT_RATE 원인 노드 선택
2. 🔍 포커스 버튼 클릭
3. → DEFECT_RATE와 직접 연결된 것만 표시:
   - Variance (수량차)
   - Material (어떤 재료에서 불량 발생?)
   - WorkCenter (어느 공정에서?)
4. 명확하게 문제 구간 파악!
```

#### 화면 예시 (포커스 전):
```
      ◉──────◉──────◉
     /│\    /│\    /│\
    / │ \  / │ \  / │ \
   ◉  ◉  ◉◉  ◉  ◉◉  ◉  ◉
    \ │ /  \ │ /  \ │ /
     \│/    \│/    \│/
      ◉──────◉──────◉
   (너무 복잡!)
```

#### 화면 예시 (포커스 후):
```
        ◉ DEFECT_RATE (선택)
       /│\
      / │ \
     ◉  ◉  ◉
  Variance M-001 WC-3
  (간결하고 명확!)
```

---

### 📌 6단계: 비교 분석
**화면:** `comparison.html`

#### 무엇을 보나요?
- 여러 생산오더/제품/공정을 **나란히 비교**
- 정상 오더 vs 문제 오더
- 동일 제품의 다른 공정 비교

#### 어떻게 분석하나요?
```
예시 시나리오:
1. "비교할 대상 선택"에서:
   - 대상 1: PO-001 (문제 오더)
   - 대상 2: PO-025 (정상 오더, 동일 제품)
2. "비교 실행" 클릭
3. 나란히 표시되는 차트에서 차이점 확인:
   - PO-001: 불량률 15%
   - PO-025: 불량률 3%
   → 불량률이 핵심 차이!
4. 공정별 차이 확인:
   - PO-001: WC-3에서 작업
   - PO-025: WC-5에서 작업
   → 특정 공정에 문제가 있음을 발견!
```

#### 화면 예시:
```
┌─────────────────────────────────────────────────────────┐
│  📊 비교 분석                                           │
├─────────────────────────────────────────────────────────┤
│  비교 대상 선택:                                        │
│  [대상 1: PO-001 (문제)]  [대상 2: PO-025 (정상)]     │
│  [비교 실행]                                            │
├──────────────────────────┬──────────────────────────────┤
│  PO-001 (QFP80-004)      │  PO-025 (QFP80-004)         │
│                          │                              │
│  총 차이: -₩2.45M        │  총 차이: -₩120K            │
│                          │                              │
│  📊 차이 분포            │  📊 차이 분포                │
│  ┌──────────┐            │  ┌──────────┐               │
│  │ ████     │수량차 85%  │  │ █        │수량차 15%     │
│  │ █        │단가차 10%  │  │ ███      │단가차 50%     │
│  │ █        │생산차 5%   │  │ ██       │생산차 35%     │
│  └──────────┘            │  └──────────┘               │
│                          │                              │
│  🔥 주요 원인:           │  🔥 주요 원인:              │
│  • DEFECT_RATE (15%)     │  • PRICE_CHANGE (3%)        │
│  • EFFICIENCY (82%)      │  • EFFICIENCY (94%)         │
│                          │                              │
│  🏭 공정: WC-3           │  🏭 공정: WC-5              │
└──────────────────────────┴──────────────────────────────┘

✅ 분석 결과:
- WC-3 공정의 불량률이 WC-5보다 5배 높음
- WC-3 설비 점검 필요
```

---

## 📋 전체 분석 플로우 요약

```
1. 대시보드 (dashboard.html)
   ↓ 문제 발견
   "상세보기" 클릭
   ↓
2. 전체 구조 파악 (analysis.html?order=PO-001)
   ↓ 차이 노드 클릭
   ↓
3. 차이 상세 확인
   ↓ 차이 노드 더블클릭
   ↓
4. 근본 원인 파악 (Cause 노드 표시)
   ↓ 포커스 기능 사용
   ↓
5. 핵심 관계만 확인
   ↓ 비교 화면으로 이동
   ↓
6. 비교 분석 (comparison.html)
   ↓
7. 개선 방안 수립
```

---

## 💡 분석 팁

### 효과적인 분석을 위한 팁
1. **항상 큰 그림부터**: 대시보드 → 상세분석
2. **단계적 드릴다운**: 전체 → 차이 → 원인 → 세부사항
3. **포커스 기능 활용**: 복잡할 때는 포커스로 단순화
4. **비교 분석 필수**: 정상 케이스와 비교하여 차이점 발견
5. **패턴 찾기**: 같은 공정/재료에서 반복되는 문제 확인

### 각 노드 색상 의미
- 🔴 **빨간색 (Product)**: 생산 제품
- 🟠 **주황색 (Material)**: 사용 재료
- 🟢 **초록색 (WorkCenter)**: 작업 공정
- 🟣 **보라색 (Variance)**: 발생 차이
- 🔵 **파란색 (Cause)**: 차이 원인
- ⚪ **회색 (ProductionOrder)**: 생산 오더

---

## 🎬 실전 예시: 완전한 분석 스토리

### 배경
2024년 2월, QFP80-004 제품의 원가가 예상보다 높게 나왔습니다.

### 분석 과정

#### Step 1: 문제 인식 (대시보드)
```
- 총 원가차이: -₩15M (예산 초과)
- PO-001이 Top 1 (-₩2.45M)
- 2월에 수량차가 급증
→ PO-001 "상세보기" 클릭
```

#### Step 2: 구조 파악 (상세분석 자동 로드)
```
URL: analysis.html?order=PO-001
- 제품: QFP80-004
- 재료: M-001 (Steel Plate), M-002 (Copper Wire)
- 공정: WC-3 (Assembly)
- 차이: 3건 (수량차 2건, 단가차 1건)
→ 수량차 V-001 클릭
```

#### Step 3: 차이 확인
```
V-001 정보:
- 유형: QUANTITY (수량차)
- 금액: -₩2,450,000
- 심각도: HIGH
- 원가요소: MATERIAL
→ V-001 더블클릭하여 원인 확인
```

#### Step 4: 원인 분석
```
3개 원인 발견:
- DEFECT_RATE: 불량률 15% (영향도 85%)
- MATERIAL_WASTE: 재료 낭비 +20kg (영향도 10%)
- EFFICIENCY: 효율 82% (영향도 5%)
→ DEFECT_RATE 선택 후 포커스
```

#### Step 5: 핵심 관계 확인
```
DEFECT_RATE 연결:
- M-001 (Steel Plate): 불량 다발
- WC-3 (Assembly): 해당 공정
- V-001: 수량차 발생
→ WC-3 공정에서 M-001 불량 다발 확인!
```

#### Step 6: 비교 분석
```
비교 대상:
- PO-001 (WC-3): 불량률 15%
- PO-025 (WC-5): 불량률 3%
→ WC-3 공정 장비에 문제 있음을 확인!
```

#### 결론 및 조치
```
✅ 문제: WC-3 Assembly 공정의 Steel Plate 불량률 급증
📌 원인: WC-3 장비 노후화 (최근 점검 3개월 전)
🔧 조치: 
   1. WC-3 장비 긴급 점검 및 부품 교체
   2. Steel Plate 입고 검수 강화
   3. WC-5 공정으로 일부 물량 이관
💰 기대효과: 불량률 15% → 5% 감소, 월 ₩2.4M 절감
```

---

## 🎓 마무리

이 시스템은 **원가차이를 단순히 보여주는 것이 아니라**,  
**왜 발생했는지, 어디서 발생했는지를 그래프로 탐색**하며,  
**근본 원인까지 추적**할 수 있도록 설계되었습니다.

### 핵심 철학
1. **시각화**: 복잡한 관계를 그래프로 직관적으로 표현
2. **상호작용**: 클릭/더블클릭으로 능동적 탐색
3. **맥락 제공**: 분석 가이드로 "지금 무엇을 봐야 하는지" 안내
4. **비교 분석**: 정상과 비정상을 비교하여 패턴 발견

### 추가 개선 가능성
- AI 기반 이상 패턴 자동 탐지
- 예측 분석 (다음 달 차이 예측)
- 실시간 알림 (차이 발생 시 즉시 통보)
- 개선 조치 이력 관리

---

**분석을 시작하세요!**  
`dashboard.html`을 열고 첫 번째 문제 오더를 찾아보세요! 🚀
